<!DOCTYPE html>
<html>
{% include head.html %}

<body class="zh_CN mm_appmsg">
  <div class="rich_media">
    <div class="rich_media_inner">
      <div>

        <div class="rich_media_area_primary">

          <h2 class="rich_media_title"><img style="height: 24px;" src="{{ '/assets/logo.png' | relative_url }}" />{{ site.title }}</h2>
          <div class="rich_media_meta_list">
            <em class="rich_media_meta rich_media_meta_text">{{ site.data.newslist.lastBuildDate }}</em>
          </div>
          <div class="rich_media_content">

            <p>
              <audio id="player" class="fullwidth" src="{{ page.voice_url }}" controls loop autoplay style="margin:20px 0; width:100%"></audio>
            </p>

            <div class="newslist">
            {% for item in site.data.newslist.news reversed %}
            <div class="card">
            <a href="#" onclick="play({{ forloop.index0 }});return false;">
              <div>
                <h2 class="newstitle">{{ item.title }}</h2>
                <p class="newsdate">{{ item.startdate }}</p>
              </div>
            </a>
            </div>
            {% endfor %}
            </div>

          </div>

          <div class="rich_media_tool">
            <a class="media_tool_meta meta_primary" href="{{ site.source_url }}" target="_blank">閲読原文</a>
          </div>
        </div>

        <div class="rich_media_area_extra">
          <div class="mpda_bottom_container">
          {% include adsense_radionews.html %}
          </div>
        </div>

      </div>
    </div>
  </div>

  <script type="text/javascript">
    var cur = -1;
    var urls = [
    {% for item in site.data.newslist.news reversed %}
    '{{ item.soundlist.sound_normal.filename }}'{% unless forloop.last %},{% endunless %}
    {% endfor %}
    ];

    var player = document.getElementById('player');

    player.onended = function() {
      var i = (cur + 1) % urls.length;
      play(i);
    }

    function play(i) {
      if (i != cur) {
        var last = cur;
        cur = i;
        console.log(last + '->' + cur)
        player.src = 'http://www.nhk.or.jp/r-news/ondemand/mp3/' + urls[cur] + '.mp3';
        player.load();
        player.play();

        var l = document.getElementsByClassName('card');
        if (last >= 0) {
          l[last].firstElementChild.classList.remove("playing");
        }
        l[cur].firstElementChild.classList.add("playing");
      }
    }

    play(0);
  </script>

</body>
</html>
